function delectReduce(e){if(""==e)return!1;if(!e)return layer.close(a),layer.alert("参数错误,请重新刷新或联系管理员"),!1;var a=layer.load(2,{shade:[.2,"#000"]});$.ajax({url:"/e/ShopSys/discount/list.josn.php",type:"post",data:{id:e},dataType:"text"}).done(function(e){1==e?(layer.msg("删除成功"),window.location.reload()):(layer.close(a),layer.msg("删除失败，请重试"))}).error(function(e){layer.msg("网络错误")})}layui.use(["form","layer"],function(e){var a=layui.form(),i=layui.layer,l=3;a.verify({price:[/^[1-9]\d*$/,"必须为整数，不能以0开头"],percent:[/^([1-9]|[1-9]\d)$/,"百分比必须为整数，不能超过99"]}),a.on("submit(demo2)",function(e){var a=i.load(2,{shade:[.2,"#000"]});console.log(e.field);for(var l=[],r=0;r<5;r++)if(void 0!=e.field["allPrice"+r]){var d=e.field["allPrice"+r],t=.01*e.field["reduce"+r];l.push({price:d,reduce:t})}var n={type:"added"};return n.title=e.field.addressname,l=JSON.stringify(l),n.list=l,$.ajax({url:"/e/ShopSys/discount/list.josn.php",type:"post",data:n,dataType:"text",async:!1}).done(function(e){1==e?(i.msg("增加成功"),window.location.reload()):(i.close(a),i.msg("失败"))}).error(function(e){i.close(a),i.msg("网络错误")}),!1}),$("#addform").on("click",".addReduce",function(){if(l>=5)return i.alert("一种方案最多添加5个满减"),!1;l++;var e='<div class="layui-form-item reduce"><div class="layui-inline"><label class="layui-form-label">优惠'+l+'：</label> <div class="layui-form-mid">上月累计消费</div><div class="layui-input-inline"   style="width: 100px;"><input lay-verify="price" type="text" name="allPrice'+l+'" placeholder="￥" autocomplete="off" class="layui-input"></div><div class="layui-form-mid">总额优惠百分之</div><div class="layui-input-inline" style="width: 100px;"><input type="text" name="reduce'+l+'" placeholder="%" autocomplete="off" class="layui-input" lay-verify="price"></div><span  class="layui-btn layui-btn-primary layui-btn-small layui-btn-radius addReduce"><i class="layui-icon">&#xe654;</i></span><span class="delReduce layui-btn layui-btn-primary layui-btn-small layui-btn-radius"><i class="layui-icon">&#xe640;</i></span></div></div>';$(".reduce:last").after(e),a.render()}),$("#addform").on("click",".delReduce",function(){$(this).parents(".reduce").remove(),l--,a.render()}),delectReduce("")});